// Copyright 2023 QMK
// SPDX-License-Identifier: GPL-2.0-or-later
// vim: shiftwidth=2 tabstop=2
#include QMK_KEYBOARD_H
#include "keymap_uk.h" // clang-format off
#include <stdio.h>

char wpm_str[10];

enum sofle_layers {
    /* _M_XYZ = Mac Os, _W_XYZ = Win/Linux */
    _BASE,
    _LOWER,
    _RAISE,
    _GAME,
    _ADJUST,
};

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
/*
 * BASE
 *  ,-----------------------------------------.                    ,-----------------------------------------.
 *  |      | #### | #### | #### | #### | #### |                    | #### | #### | #### | #### | #### | #### |
 *  |------+------+------+------+------+------|                    |------+------+------+------+------+------|
 *  |ESC[`]|   Q  |   W  |   E  |   R  |   T  |                    |   Y  |   U  |   I  |   O  |   P  | Bspc |
 *  |------+------+------+------+------+------|                    |------+------+------+------+------+------|
 *  | Tab  | C-A  | S-S  | G-D  | A-F  |   G  |-------.    ,-------|   H  | A-J  | G-K  | S-L  | C-;-:| #####|
 *  |------+------+------+------+------+------|  MUTE |    | MUTE  |------+------+------+------+------+------|
 *  | \ [|]|   Z  |   X  |   C  |   V  |   B  |-------|    |-------|   N  |   M  |  ,-< |  .-> |  /-? | #   |
 *  `----------------------------------------/       /    \      \-----------------------------------------'
 *            | RBT  | #####| #####| #####| / Space /       \ Enter\  | Raise| PSCR | #####| RBT  |
 *            |      |      |      |      |/       /         \      \ |      |      |      |      |
 *            `----------------------------------'           '------''---------------------------'
 */

[_BASE] = LAYOUT(
/* 1 */ XXXXXXX,  XXXXXXX,      XXXXXXX,      XXXXXXX,      XXXXXXX,      XXXXXXX,        /* SPLIT */           XXXXXXX, XXXXXXX,         XXXXXXX,         XXXXXXX,         XXXXXXX,             XXXXXXX, /* # */
/* 2 */ QK_GESC,  KC_Q,         KC_W,         KC_E,         KC_R,         KC_T,           /* SPLIT */           KC_Y, KC_U,         KC_I,         KC_O,         KC_P,             KC_BSPC, /* # */
/* 3 */ KC_TAB,   LCTL_T(KC_A), LSFT_T(KC_S), LGUI_T(KC_D), LALT_T(KC_F), KC_G,           /* SPLIT */           KC_H, RALT_T(KC_J), RGUI_T(KC_K), RSFT_T(KC_L), RCTL_T(KC_SCLN),  KC_QUOT, /* # */
/* 4 */ KC_BSLS,  KC_Z,         KC_X,         KC_C,         KC_V,         KC_B,   KC_MUTE,  /* SPLIT */ KC_MUTE,  KC_N, KC_M,         KC_COMM,      KC_DOT,       KC_SLSH,          KC_HASH, /* # */
/* Special */   XXXXXXX,  XXXXXXX,  OSL(_LOWER), MO(_LOWER), KC_SPC, /* SPLIT */ KC_ENT, MO(_RAISE), OSL(_RAISE),  XXXXXXX,  XXXXXXX
),


/* LOWER
*  ,-----------------------------------------.                    ,-----------------------------------------.
*  |      |      |      |      |      |      |                    |      |      |      |      |      |      |
*  |------+------+------+------+------+------|                    |------+------+------+------+------+------|
*  | ____ | F1   | F2   | F3   | F4   | F5   |                    | F6   | F7   | F8   | F9   | F10  | F11  |
*  |------+------+------+------+------+------|                    |------+------+------+------+------+------|
*  | ____ | !    | "    | #    | $    |   %  |-------.            |   ^  |   &  |   *  | - (_)| = (+)| F12  |
*  |------+------+------+------+------+------|       |    |       |------+------+------+------+------+------|
*  | ____ | ____ | ____ | ____ |   {  |  [   |-------|    |-------|  ]   |   }  |   :  | ____ | ____ |  #   |
*  `-----------------------------------------/       /     \      \-----------------------------------------'
*             | ____ | ____ | ____ |_____ | /_____  /       \_____ \  |_____ | _____| _____| ____ |
*             |      |      |      |      |/       /         \      \ |      |      |      |      |
*             `----------------------------------'           '------''---------------------------'
*/
[_LOWER] = LAYOUT( /* This one is for symbols and misc */
/* 4 */ XXXXXXX,    XXXXXXX,    XXXXXXX,    XXXXXXX,    XXXXXXX,    XXXXXXX,            /* SPLIT */             XXXXXXX,    XXXXXXX,    XXXXXXX,    XXXXXXX,    XXXXXXX,    XXXXXXX,    /* # */
/* 1 */ XXXXXXX,    KC_F1,      KC_F2,      KC_F3,      KC_F4,      KC_F5,              /* SPLIT */             KC_F6,      KC_F7,      KC_F8,      KC_F9,      KC_F10,     KC_F11,     /* # */
/* 3 */ XXXXXXX,    KC_EXLM,    KC_DQUO,    UK_PND,     KC_DLR,     KC_PERC,            /* SPLIT */             KC_CIRC,    KC_AMPR,    KC_ASTR,    KC_MINS,    KC_EQL,     KC_F12,     /* # */
/* 4 */ KC_BSLS,    XXXXXXX,    XXXXXXX,    XXXXXXX,    KC_LCBR,    KC_LBRC, XXXXXXX,   /* SPLIT */ XXXXXXX,    KC_RBRC,    KC_RCBR,    KC_COLN,    _______,    _______,    KC_HASH,    /* # */
/* Special */                            QK_BOOT, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,            XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, QK_BOOT
),
// /* 3 */ XXXXXXX,    XXXXXXX,    XXXXXXX,    XXXXXXX,    XXXXXXX,    KC_LPRN,            /* SPLIT */             KC_RPRN,    XXXXXXX,    KC_HASH,    KC_PIPE,    KC_TILD,    _______,    /* # */

/* RAISE
 *
 *                                      ,----------------------------------------.                    ,-----------------------------------------.
 *                                      | ____ | ____ | ____ | ____ | ____ | ____ |                    | ____ | ____ | ____ | ____ | ____ | ____ |
 *                                      |------+------+------+------+------+------|                    |------+------+------+------+------+------|
 *                                      | ____ | ____ | ____ | ____ |CPSTOG|CPSLCK|-------.    ,-------| <L>  | <D>  | <U>  | <R>  |      | Del  |
 *                                      |------+------+------+------+------+------|                    |------+------+------+------+------+------|
 *                                      | ____ |  1   |  2   |  3   |  4   |  5   |                    |  6   |  7   |  8   |  9   |  0   | ____ |
 *                                      |------+------+------+------+------+------| ____  |    | ____  |------+------+------+------+------+------|
 *                                      | ____ | ____ | ____ | ____ | ____ | ____ |-------|    |-------| Home | PGDN | PGUP | End  | Dot | ____  |
 *                                      `-----------------------------------------/       /     \      \-----------------------------------------'
 *                                                 | ____ | ____ | ____ | ____ | / ____  /       \ ____ \  | ____ | PrtSc| ____ | ____ |
 *                                                 |      |      |      |      |/       /         \      \ |      |      |      |      |
 *                                                 `----------------------------------'           '------''---------------------------'
 */
[_RAISE] = LAYOUT(
/* 1 */ XXXXXXX,    XXXXXXX,    XXXXXXX,    XXXXXXX,    XXXXXXX,    XXXXXXX,            /* SPLIT */             XXXXXXX,    XXXXXXX,    XXXXXXX,    XXXXXXX,    XXXXXXX,    KC_BSPC,    /* # */
/* 3 */ XXXXXXX,    XXXXXXX,    XXXXXXX,    XXXXXXX,    CW_TOGG,    KC_CAPS,            /* SPLIT */             KC_LEFT,    KC_DOWN,    KC_UP,      KC_RGHT,    XXXXXXX,     KC_DEL,     /* # */
/* 2 */ XXXXXXX,    KC_1,       KC_2,       KC_3,       KC_4,       KC_5,               /* SPLIT */             KC_6,       KC_7,       KC_8,       KC_9,       KC_0,       XXXXXXX,    /* # */
/* 4 */ XXXXXXX,    XXXXXXX,    XXXXXXX,    XXXXXXX,    XXXXXXX,    XXXXXXX,  XXXXXXX,  /* SPLIT */ XXXXXXX,    KC_HOME,    KC_PGUP,    KC_PGDN,    KC_END,     KC_DOT,     XXXXXXX,     /* # */
/* Special */                        XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,       /* SPLIT */     XXXXXXX, XXXXXXX, KC_PSCR, XXXXXXX, XXXXXXX                                     /* # */
),
/* ADJUST
 *                                      ,-----------------------------------------.                    ,-----------------------------------------.
 *                                      |      |      |      |      |      |      |                    |      |      |      |      |      |      |
 *                                      |------+------+------+------+------+------|                    |------+------+------+------+------+------|
 *                                      | QK_BOOT|      |BASE|COLEMAK|      |      |                    |      |      |      |      |      |      |
 *                                      |------+------+------+------+------+------|                    |------+------+------+------+------+------|
 *                                      |      |      |MACWIN|      |      |      |-------.    ,-------|      | VOLDO| MUTE | VOLUP|      |      |
 *                                      |------+------+------+------+------+------|  MUTE |    |       |------+------+------+------+------+------|
 *                                      |      |      |      |      |      |      |-------|    |-------|      | PREV | PLAY | NEXT |      |      |
 *                                      `-----------------------------------------/       /     \      \-----------------------------------------'
 *                                                 | LGUI | LAlt | LCTR |LOWER | /Enter  /       \Space \  |RAISE | RCTR | RAlt | RGUI |
 *                                                 |      |      |      |      |/       /         \      \ |      |      |      |      |
 *                                                 `----------------------------------'           '------''---------------------------'
 */
  [_ADJUST] = LAYOUT(
/* 1 */ XXXXXXX,    XXXXXXX,    XXXXXXX,    XXXXXXX,    XXXXXXX,    XXXXXXX,            /* SPLIT */             XXXXXXX,    XXXXXXX,    XXXXXXX,    XXXXXXX,    XXXXXXX,    XXXXXXX,    /* # */
/* 2 */ QK_BOOT,    XXXXXXX,    XXXXXXX,  TG(_GAME),    XXXXXXX,    XXXXXXX,            /* SPLIT */             XXXXXXX,    XXXXXXX,    XXXXXXX,    XXXXXXX,    XXXXXXX,    XXXXXXX,    /* # */
/* 3 */ XXXXXXX,    XXXXXXX,    XXXXXXX,    XXXXXXX,    XXXXXXX,    XXXXXXX,            /* SPLIT */             XXXXXXX,    KC_VOLD,    KC_MUTE,    KC_VOLU,    XXXXXXX,    XXXXXXX,    /* # */
/* 4 */ XXXXXXX,    XXXXXXX,    XXXXXXX,    XXXXXXX,    XXXXXXX,    XXXXXXX, XXXXXXX,   /* SPLIT */ XXXXXXX,    XXXXXXX,    KC_MPRV,    KC_MPLY,    KC_MNXT,    XXXXXXX,    XXXXXXX,    /* # */
/* Special */                       XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,        /* SPLIT */     XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX                                     /* # */
  ),

/*
 * GAME
 *                                                  ,-----------------------------------------.                    ,-----------------------------------------.
 *                                                  | ESC  | 1 (!)|  2(")|  3(£)|  4($)| 5(%) |                    | 6(^) | 7(&) | 8(*) |  9(  | 0 )  | Bspc |
 *                                                  |------+------+------+------+------+------|                    |------+------+------+------+------+------|
 *                                                  | Tab  |   Q  |   W  |   E  |   R  |   T  |                    |   Y  |   U  |   I  |   O  |   P  | #####|
 *                                                  |------+------+------+------+------+------|                    |------+------+------+------+------+------|
 *                                                  | SHFT |   A  |   S  |   D  |   F  |   G  |-------.    ,-------|   H  |   J  |   K  |   L  |   ;  | ' (@)|
 *                                                  |------+------+------+------+------+------|  MUTE |    |       |------+------+------+------+------+------|
 *                                                  | CTRL |   Z  |   X  |   C  |   V  |   B  |-------|    |-------|   N  |   M  | , (<) | . (>) | / (?)|# (~)|
 *                                                  `-----------------------------------------/       /     \      \-----------------------------------------'
 *                                                             | #### | #### | #### |GLOWER| / Space /       \ Enter\  |RAISE | #### | #### | #### |
 *                                                             |      |      |      |      |/       /         \      \ |      |      |      |      |
 *                                                             `----------------------------------'           '------''---------------------------'
 */

[_GAME] = LAYOUT(
/* 1 */ QK_GESC,    KC_1,           KC_2,           KC_3,           KC_4,           KC_5,           /* SPLIT */             KC_6,   KC_7,           KC_8,           KC_9,           KC_0,               KC_BSPC, /* # */
/* 2 */ KC_TAB,     KC_Q,           KC_W,           KC_E,           KC_R,           KC_T,           /* SPLIT */             KC_Y,   KC_U,           KC_I,           KC_O,           KC_P,               XXXXXXX, /* # */
/* 3 */ KC_LSFT,     KC_A,           KC_S,           KC_D,           KC_F,           KC_G,           /* SPLIT */             KC_H,   KC_J,           KC_K,           KC_L,           KC_SCLN,            KC_QUOT, /* # */
/* 4 */ KC_LCTL,    KC_Z,           KC_X,           KC_C,           KC_V,           KC_B, KC_MUTE,  /* SPLIT */ XXXXXXX,    KC_N,   KC_M,           KC_COMM,        KC_DOT,         KC_SLSH,            KC_HASH, /* # */
/* Special */                                   XXXXXXX, XXXXXXX, KC_LALT, XXXXXXX,   KC_SPC,     /* SPLIT */     KC_ENT, MO(_RAISE), XXXXXXX, XXXXXXX, XXXXXXX
    ),

/*
 * GAME RIGHT
 *                                                  ,-----------------------------------------.                    ,-----------------------------------------.
 *                                                  | ESC  | 1 (!)|  2(")|  3(£)|  4($)| 5(%) |                    | 6(^) | 7(&) | 8(*) |  9(  | 0 )  | Bspc |
 *                                                  |------+------+------+------+------+------|                    |------+------+------+------+------+------|
 *                                                  | Tab  |   Q  |   W  |   E  |   R  |   T  |                    |   Y  |   U  |   I  |   O  |   P  | #####|
 *                                                  |------+------+------+------+------+------|                    |------+------+------+------+------+------|
 *                                                  | SHFT |   A  |   S  |   D  |   F  |   G  |-------.    ,-------|   H  |   J  |   K  |   L  |   ;  | ' (@)|
 *                                                  |------+------+------+------+------+------|  MUTE |    |       |------+------+------+------+------+------|
 *                                                  | CTRL |   Z  |   X  |   C  |   V  |   B  |-------|    |-------|   N  |   M  | , (<) | . (>) | / (?)|# (~)|
 *                                                  `-----------------------------------------/       /     \      \-----------------------------------------'
 *                                                             | #### | #### | #### |GLOWER| / Space /       \ Enter\  |RAISE | #### | #### | #### |
 *                                                             |      |      |      |      |/       /         \      \ |      |      |      |      |
 *                                                             `----------------------------------'           '------''---------------------------'
 */
};

static void render_right_oled(void) {
    // static const char PROGMEM qmk_logo[] = {
    //     0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8a,0x8b,0x8c,0x8d,0x8e,0x8f,0x90,0x91,0x92,0x93,0x94,
    //     0xa0,0xa1,0xa2,0xa3,0xa4,0xa5,0xa6,0xa7,0xa8,0xa9,0xaa,0xab,0xac,0xad,0xae,0xaf,0xb0,0xb1,0xb2,0xb3,0xb4,
    //     0xc0,0xc1,0xc2,0xc3,0xc4,0xc5,0xc6,0xc7,0xc8,0xc9,0xca,0xcb,0xcc,0xcd,0xce,0xcf,0xd0,0xd1,0xd2,0xd3,0xd4,0
    // };

    // oled_write_P(qmk_logo, false);
    // Idle animation
    // static const char PROGMEM idle[IDLE_FRAMES][ANIM_SIZE] = {

    //     {
    //         0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,64,64,32,32,32,32,16,16,16,16,16,8,8,4,4,4,8,48,64,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,128,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,100,130,2,2,2,2,2,1,0,0,0,0,128,128,0,0,0,0,0,0,0,0,0,128,0,48,48,0,192,193,193,194,4,8,16,32,64,128,0,0,0,128,128,128,128,64,64,
    //         64,64,32,32,32,32,16,16,16,16,8,8,8,8,8,4,4,4,4,4,2,2,2,2,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,56,4,3,0,0,0,0,0,0,0,12,12,12,13,1,0,64,160,33,34,18,17,17,17,9,8,8,8,8,4,4,8,8,16,16,16,16,16,17,15,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,128,128,128,128,64,64,64,64,64,32,32,32,32,32,16,16,16,16,16,8,8,8,8,8,4,4,4,4,4,2,3,2,2,1,1,1,1,1,1,2,2,4,4,8,8,8,8,8,7,
    //         0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
    //     },

    //     {
    //         0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,64,64,32,32,32,32,16,16,16,16,16,8,8,4,4,4,8,48,64,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,128,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,100,130,2,2,2,2,2,1,0,0,0,0,128,128,0,0,0,0,0,0,0,0,0,128,0,48,48,0,192,193,193,194,4,8,16,32,64,128,0,0,0,128,128,128,128,64,64,
    //         64,64,32,32,32,32,16,16,16,16,8,8,8,8,8,4,4,4,4,4,2,2,2,2,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,56,4,3,0,0,0,0,0,0,0,12,12,12,13,1,0,64,160,33,34,18,17,17,17,9,8,8,8,8,4,4,8,8,16,16,16,16,16,17,15,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,128,128,128,128,64,64,64,64,64,32,32,32,32,32,16,16,16,16,16,8,8,8,8,8,4,4,4,4,4,2,3,2,2,1,1,1,1,1,1,2,2,4,4,8,8,8,8,8,
    //         7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
    //     },

    //     {
    //         0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,128,64,64,64,64,32,32,32,32,16,8,4,2,2,4,24,96,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,128,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,60,194,1,1,2,2,4,4,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,96,0,129,130,130,132,8,16,32,64,128,0,0,0,0,128,128,128,128,64,64,64,64,32,
    //         32,32,32,16,16,16,16,8,8,8,8,8,4,4,4,4,4,2,2,2,2,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,112,25,6,0,0,0,0,0,0,0,24,24,24,27,3,0,64,160,34,36,20,18,18,18,11,8,8,8,8,5,5,9,9,16,16,16,16,16,17,15,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,128,128,128,128,64,64,64,64,64,32,32,32,32,32,16,16,16,16,16,8,8,8,8,8,4,4,4,4,4,2,3,2,2,1,1,1,1,1,1,2,2,4,4,8,8,8,8,8,7,0,0,0,
    //         0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
    //     },

    //     {
    //         0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,128,0,0,0,0,0,128,64,64,32,32,32,32,16,16,16,16,8,4,2,1,1,2,12,48,64,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,128,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,30,225,0,0,1,1,2,2,1,0,0,0,0,128,128,0,0,0,0,0,0,0,0,0,128,0,48,48,0,192,193,193,194,4,8,16,32,64,128,0,0,0,128,128,128,128,64,64,
    //         64,64,32,32,32,32,16,16,16,16,8,8,8,8,8,4,4,4,4,4,2,2,2,2,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,112,12,3,0,0,0,0,0,0,0,12,12,12,13,1,0,64,160,33,34,18,17,17,17,9,8,8,8,8,4,4,8,8,16,16,16,16,16,17,15,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,128,128,128,128,64,64,64,64,64,32,32,32,32,32,16,16,16,16,16,8,8,8,8,8,4,4,4,4,4,2,3,2,2,1,1,1,1,1,1,2,2,4,4,8,8,8,8,8,
    //         7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
    //     },

    //     {
    //         0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,64,64,32,32,32,32,16,16,16,16,8,8,4,2,2,2,4,56,64,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,128,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,28,226,1,1,2,2,2,2,1,0,0,0,0,128,128,0,0,0,0,0,0,0,0,0,128,0,48,48,0,192,193,193,194,4,8,16,32,64,128,0,0,0,128,128,128,128,64,64,64,64,
    //         32,32,32,32,16,16,16,16,8,8,8,8,8,4,4,4,4,4,2,2,2,2,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,112,12,3,0,0,0,0,0,0,0,12,12,12,13,1,0,64,160,33,34,18,17,17,17,9,8,8,8,8,4,4,8,8,16,16,16,16,16,17,15,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,128,128,128,128,64,64,64,64,64,32,32,32,32,32,16,16,16,16,16,8,8,8,8,8,4,4,4,4,4,2,3,2,2,1,1,1,1,1,1,2,2,4,4,8,8,8,8,8,7,0,0,
    //         0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
    //     }

    // };

    // Prep animation
    // static const char PROGMEM prep[][ANIM_SIZE] = {

    //     {
    //         0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,128,0,0,0,0,0,128,64,64,32,32,32,32,16,16,16,16,8,4,2,1,1,2,12,48,64,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,128,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,30,225,0,0,1,1,2,2,129,128,128,0,0,128,128,0,0,0,0,0,0,0,0,0,128,0,48,48,0,0,1,225,26,6,9,49,53,1,138,124,0,0,128,128,128,128,64,64,
    //         64,64,32,32,32,32,16,16,16,16,8,8,8,8,8,4,4,4,4,4,2,2,2,2,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,112,12,3,0,0,24,6,5,152,153,132,195,124,65,65,64,64,32,33,34,18,17,17,17,9,8,8,8,8,4,4,4,4,4,4,2,2,2,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,128,128,128,128,64,64,64,64,64,32,32,32,32,32,16,16,16,16,16,8,8,8,8,8,4,4,4,4,4,2,3,2,2,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,
    //         0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
    //     }

    // };

    // Typing animation
    // static const char PROGMEM tap[TAP_FRAMES][ANIM_SIZE] = {

    //     {
    //         0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,128,0,0,0,0,0,128,64,64,32,32,32,32,16,16,16,16,8,4,2,1,1,2,12,48,64,128,0,0,0,0,0,0,0,248,248,248,248,0,0,0,0,0,128,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,128,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,30,225,0,0,1,1,2,2,129,128,128,0,0,128,128,0,0,0,0,0,0,0,0,0,128,0,48,48,0,0,1,1,2,4,8,16,32,67,135,7,1,0,184,188,190,159,
    //         95,95,79,76,32,32,32,32,16,16,16,16,8,8,8,8,8,4,4,4,4,4,2,2,2,2,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,112,12,3,0,0,24,6,5,152,153,132,67,124,65,65,64,64,32,33,34,18,17,17,17,9,8,8,8,8,4,4,8,8,16,16,16,16,16,17,15,1,61,124,252,252,252,252,252,60,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,128,128,128,128,64,64,64,64,64,32,32,32,32,32,16,16,16,16,16,8,8,8,8,8,4,4,4,4,4,2,3,2,2,1,1,1,
    //         1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
    //     },

    //     {
    //         0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,128,0,0,0,0,0,128,64,64,32,32,32,32,16,16,16,16,8,4,2,1,1,2,12,48,64,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,128,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,30,225,0,0,1,1,2,2,1,0,0,0,0,128,128,0,0,0,0,0,0,0,0,0,128,0,48,48,0,0,1,225,26,6,9,49,53,1,138,124,0,0,128,128,128,128,64,64,64,64,32,
    //         32,32,32,16,16,16,16,8,8,8,8,8,4,4,4,4,4,2,2,2,2,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,112,12,3,0,0,0,0,0,0,0,0,0,0,1,1,0,64,160,33,34,18,17,17,17,9,8,8,8,8,4,4,4,4,4,4,2,2,2,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,128,128,128,128,64,64,64,64,64,32,32,32,32,32,16,16,16,16,16,8,8,8,8,8,4,4,4,4,4,2,3,122,122,121,121,121,121,57,49,2,2,4,4,8,8,8,136,136,135,128,
    //         0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
    //     }

    // };

    // void animation_phase(void) {

    //     if (get_current_wpm() <=IDLE_SPEED) {
    //         current_idle_frame = (current_idle_frame + 1) % IDLE_FRAMES;
    //         oled_write_raw_P(idle[abs((IDLE_FRAMES-1)-current_idle_frame)], ANIM_SIZE);
    //     }

    //     if (get_current_wpm() >IDLE_SPEED && get_current_wpm() <TAP_SPEED) {
    //         oled_write_raw_P(prep[0], ANIM_SIZE);
    //     }

    //     if (get_current_wpm() >=TAP_SPEED) {
    //         current_tap_frame = (current_tap_frame + 1) % TAP_FRAMES;
    //         oled_write_raw_P(tap[abs((TAP_FRAMES-1)-current_tap_frame)], ANIM_SIZE);
    //     }
    // }

    // if (get_current_wpm() != 000) {
    //     oled_on();

    //     if (timer_elapsed32(anim_timer) > ANIM_FRAME_DURATION) {
    //         anim_timer = timer_read32();
    //         animation_phase();
    //     }

    //     anim_sleep = timer_read32();
    // } else {
    //     if (timer_elapsed32(anim_sleep) > oled_timeout) {
    //         oled_off();
    //     } else {
    //         if (timer_elapsed32(anim_timer) > ANIM_FRAME_DURATION) {
    //             anim_timer = timer_read32();
    //             animation_phase();
    //         }
    //     }
    // }
}

static void render_left_oled(void) {
    // Print current mode
    oled_write_P(PSTR("      "), false);
    sprintf(wpm_str, "%03d", get_current_wpm());
    oled_write(wpm_str, false);
    oled_write_P(PSTR("   WPM"), false);


    // oled_write_P(PSTR("\n\n"), false);
    // oled_write_ln_P(PSTR("MODE"), false);
    // oled_write_ln_P(PSTR(""), false);
    // oled_write_ln_P(PSTR("LIN"), false);

    switch (get_highest_layer(default_layer_state)) {
        case _BASE:
            oled_write_ln_P(PSTR("Qwrt"), false);
            break;
        default:
            oled_write_P(PSTR("Undef"), false);
    }
    oled_write_P(PSTR("\n\n"), false);
    // Print current layer
    oled_write_ln_P(PSTR("LAYER"), false);
    switch (get_highest_layer(layer_state)) {
        case _BASE:
            oled_write_P(PSTR("Base\n"), false);
            break;
        case _RAISE:
            oled_write_P(PSTR("Raise"), false);
            break;
        case _LOWER:
            oled_write_P(PSTR("Lower"), false);
            break;
        case _ADJUST:
            oled_write_P(PSTR("Adjust"), false);
            break;
        case _GAME:
            oled_write_P(PSTR("Game"), false);
            break;
        default:
            oled_write_ln_P(PSTR("Undef"), false);
    }

    oled_write_P(PSTR("\n\n"), false);

    // Print if caps lock or word lock is on
    if (is_caps_word_on()) {
        oled_write_ln_P(PSTR("CPWRD"), true);
    } else {
        led_t led_usb_state = host_keyboard_led_state();
        oled_write_ln_P(PSTR("CPSLK"), led_usb_state.caps_lock);
    }
}

bool oled_task_user(void) {
    if (is_keyboard_master()) {
        render_left_oled();
    } else {
        render_right_oled();
    }
    return false;
}

layer_state_t layer_state_set_user(layer_state_t state) {
    return update_tri_layer_state(state, _LOWER, _RAISE, _ADJUST);
}
